修复Docker容器在极空间NAS上的权限问题
=============================================

日期：2025-12-09
问题：Docker容器在极空间NAS上无法创建和更新记录

问题分析：
-----------
1. 极空间NAS创建的目录权限问题
2. Docker容器内非root用户（nextjs uid=1001）无法写入宿主机目录
3. 容器启动时没有权限检查和修复机制

解决方案：
-----------
1. 创建docker-entrypoint.sh初始化脚本
   - 检测并修复数据目录权限
   - 以root启动，设置完权限后降权运行
   - 自动创建必要的目录和初始文件

2. 修改Dockerfile
   - 添加ENTRYPOINT指向初始化脚本
   - 保留非root用户用于运行时

3. 更新docker-compose.yml
   - 使用user: "0:0"以root启动容器
   - 修正DATABASE_URL路径为diaries.json

4. 更新README.md
   - 添加NAS设备部署指南
   - 提供故障排除建议

关键代码修改：
-------------
1. docker-entrypoint.sh：权限检查和修复逻辑
2. Dockerfile：添加ENTRYPOINT配置
3. docker-compose.yml：添加user配置

测试建议：
---------
1. 重新构建Docker镜像
2. 在极空间NAS上重新部署
3. 检查容器初始化日志
4. 验证创建和更新记录功能

后续改进：
---------
- 可以考虑添加更详细的日志输出
- 增加数据目录的健康检查
- 支持自定义运行用户ID